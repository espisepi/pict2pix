var pict2pix;(()=>{"use strict";var t={d:(i,e)=>{for(var a in e)t.o(e,a)&&!t.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:e[a]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{animate:()=>x,stop:()=>A});class e{#config;#x;#y;#originalX;#originalY;#targetX;#targetY;#maxDistance;#color;#minForce;constructor(t,i){this.#config=t,this.#x=0,this.#y=0,this.#originalX=i.x,this.#originalY=i.y,this.setTargetToOrigin(),this.#color=i.color,this.#minForce=.001*(Math.random()*this.#config.speed+this.#config.speed/2)}setTarget(t,i){this.#targetX=t,this.#targetY=i}setTargetToOrigin(){this.#targetX=this.#originalX,this.#targetY=this.#originalY}setPos(t,i){this.#x=t,this.#y=i}getX(){return this.#x}getY(){return this.#y}getOriginalX(){return this.#originalX}getOriginalY(){return this.#originalY}getTargetX(){return this.#targetX}getTargetY(){return this.#targetY}update(t,i){const e=this.#targetX-this.#x,a=this.#targetY-this.#y;return Math.abs(e)>1||Math.abs(a)>1?(this.#x+=i*e*t*this.#minForce,this.#y+=i*a*t*this.#minForce,!1):(this.#x=this.#targetX,this.#y=this.#targetY,!0)}draw(t){t.beginPath(),t.arc(this.#x,this.#y,2,0,2*Math.PI),t.closePath(),t.fillStyle=this.#color,t.fill()}}class a extends class{config;constructor(t){this.config=t}update(t){}draw(t){}}{constructor(t){super(t),this.x=Math.random()*this.config.maxWidth,this.y=Math.random()*this.config.maxHeight,this.speed=0,this.size=2*Math.random()+.2,this.color}update(t){this.y+=(3-this.speed)*t*.03*this.config.verticalSpeed,this.x+=(3-this.speed)*t*.03*this.config.horizontalSpeed,this.y>=this.config.maxHeight&&this.config.verticalSpeed>0&&(this.y=0,this.x=Math.random()*this.config.maxWidth),this.y<0&&this.config.verticalSpeed<0&&(this.y=this.config.maxHeight-1,this.x=Math.random()*this.config.maxWidth),this.x>=this.config.maxWidth&&this.config.horizontalSpeed>0&&(this.x=0,this.y=Math.random()*this.config.maxHeight),this.x<0&&this.config.horizontalSpeed<0&&(this.x=this.config.maxWidth-1,this.y=Math.random()*this.config.maxHeight);let i=Math.floor(this.y),e=Math.floor(this.x);i>=0&&i<this.config.maxHeight&&e>=0&&e<this.config.maxWidth&&(this.speed=this.config.mappedImage[i][e][0],this.color=this.config.mappedImage[i][e][1])}draw(t){t.beginPath(),t.globalAlpha=1,t.fillStyle=this.color,t.strokeStyle=this.color,t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fill()}}class s extends a{#angle=0;constructor(t){super(t)}update(t){super.update(t),this.#angle+=this.speed/20,this.y+=Math.sin(this.#angle),this.x+=Math.cos(this.#angle)}}class r{static#particles={"straight-particle":t=>new a(t),"twisted-particle":t=>new s(t),"led-matrix":(t,i)=>new e(t,i)};static createParticle(t,i){return this.#particles[t.particleType]?.(t,i)??new a}}class h{#config;#particlesArray=[];constructor(t){this.#config=t;let i=document.createElement("canvas");i.width=this.#config.image.width,i.height=this.#config.image.height;let e=i.getContext("2d");e.drawImage(this.#config.image,0,0,this.#config.image.width,this.#config.image.height);const a=e.getImageData(0,0,this.#config.image.width,this.#config.image.height);this.#config.numberOfParticles=this.#config.numberOfParticles||3e3,this.#config.maxWidth=this.#config.image.width,this.#config.maxHeight=this.#config.image.height,this.#config.mappedImage=this.mapImage(a),this.#config.verticalSpeed=t.verticalSpeed??1,this.#config.horizontalSpeed=t.horizontalSpeed??1;for(let i=0;i<this.#config.numberOfParticles;i++)this.#particlesArray.push(r.createParticle(t))}update(t){for(let i=0;i<this.#particlesArray.length;i++)this.#particlesArray[i].update(t)}draw(t){t.globalAlpha=.01,t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,this.#config.maxWidth,this.#config.maxHeight);for(let i=0;i<this.#particlesArray.length;i++)this.#particlesArray[i].draw(t)}mapImage(t){let i=[];for(let e=0;e<this.#config.maxHeight;e++){let a=[];for(let i=0;i<this.#config.maxWidth;i++){const s=t.data[4*e*t.width+4*i],r=t.data[4*e*t.width+(4*i+1)],h=t.data[4*e*t.width+(4*i+2)],n=[this.calculateRelativeBrightness(s,r,h),"rgb("+s+","+r+","+h+")"];a.push(n)}i.push(a)}return i}calculateRelativeBrightness(t,i,e){return Math.sqrt(t*t*.299+i*i*.587+e*e*.114)/100}}class n{ledMatrixEffect;setLedMatrixEffect(t){this.ledMatrixEffect=t}update(t){}setLedMatrixEffect(t){this.ledMatrixEffect=t}}class c extends n{#config;#particlesArray;constructor(t,i){super(),this.#config=t,this.#particlesArray=i;const e=Math.random()*this.#config.image.width,a=Math.random()*this.#config.image.height;for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setTarget(e,a)}update(t){let i=!0;for(let e=0;e<this.#particlesArray.length;e++){let a=this.#particlesArray[e].update(t,2);i=i&&a}i&&this.ledMatrixEffect.setState(f.createLedMatrixState("returning",this.#config,this.#particlesArray))}}class o extends n{#config;#particlesArray;constructor(t,i){super(),this.#config=t,this.#particlesArray=i;for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setTarget(this.#particlesArray[t].getOriginalX(),0)}update(t){let i=!0;for(let e=0;e<this.#particlesArray.length;e++){let a=this.#particlesArray[e].update(t,2);i=i&&a}if(i){for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setPos(this.#particlesArray[t].getOriginalX(),this.#config.image.height-1);this.ledMatrixEffect.setState(f.createLedMatrixState("returning",this.#config,this.#particlesArray))}}}class g extends n{#config;#particlesArray;constructor(t,i){super(),this.#config=t,this.#particlesArray=i;for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setTarget(0,this.#particlesArray[t].getOriginalY())}update(t){let i=!0;for(let e=0;e<this.#particlesArray.length;e++){let a=this.#particlesArray[e].update(t,2);i=i&&a}if(i){for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setPos(this.#config.image.width-1,this.#particlesArray[t].getOriginalY());this.ledMatrixEffect.setState(f.createLedMatrixState("returning",this.#config,this.#particlesArray))}}}class l extends n{#config;#particlesArray;constructor(t,i){super(),this.#config=t,this.#particlesArray=i;for(let t=0;t<this.#particlesArray.length;t++)this.#particlesArray[t].setTargetToOrigin()}update(t){let i=!0;for(let e=0;e<this.#particlesArray.length;e++){let a=this.#particlesArray[e].update(t,1);i=i&&a}i&&this.ledMatrixEffect.setState(f.createLedMatrixState("idle",this.#config,this.#particlesArray))}}class d extends n{#accumulatedTime=0;#config;#particlesArray;constructor(t,i){super(),this.#config=t,this.#particlesArray=i}update(t){this.#accumulatedTime+=t,this.#accumulatedTime>this.#config.transitionTime&&this.ledMatrixEffect.setState(f.createLedMatrixState(this.#config.type,this.#config,this.#particlesArray))}}class f{static#states={point:(t,i)=>new c(t,i),horizontal:(t,i)=>new o(t,i),vertical:(t,i)=>new g(t,i),returning:(t,i)=>new l(t,i),idle:(t,i)=>new d(t,i)};static createLedMatrixState(t,i,e){let a;return a="random"===t?f.getRandomState():t,f.#states[a]?.(i,e)??new c(i,e)}static getRandomState(){const t=Math.floor(3*Math.random());return Object.keys(f.#states)[t]}}class p{#config;#particlesArray=[];#state;constructor(t){this.#config=t,this.#config.speed=t.speed&&t.speed>=1&&t.speed<=10?t.speed:8,this.#config.transitionTime=t.transitionTime??8e3;const i=this.reduceImage(this.#config.image);this.createParticlesFromImage(i,t),this.setState(f.createLedMatrixState("returning",this.#config,this.#particlesArray))}setState(t){this.#state=t,this.#state.setLedMatrixEffect(this)}createParticlesFromImage(t,i){for(var e=0;e<t.height;e++)for(var a=0;a<t.width;a++)if(t.data[4*e*t.width+4*a+3]>128){let s="rgb("+t.data[4*e*t.width+4*a]+","+t.data[4*e*t.width+4*a+1]+","+t.data[4*e*t.width+4*a+2]+")",h=r.createParticle(i,{x:4*a,y:4*e,color:s});this.#particlesArray.push(h)}}reduceImage(t){const i=document.createElement("canvas"),e=t.width/4,a=t.height/4;i.width=e,i.height=a;const s=i.getContext("2d");return s.drawImage(t,0,0,e,a),s.getImageData(0,0,e,a)}update(t){this.#state.update(t)}draw(t){t.clearRect(0,0,this.#config.image.width,this.#config.image.height);for(let i=0;i<this.#particlesArray.length;i++)this.#particlesArray[i].draw(t)}}class m{static#effects={"straight-particle":t=>new h(t),"twisted-particle":t=>new h(t),"led-matrix":t=>new p(t)};static createParticle(t){return this.#effects[t.particleType]?.(t)??new h(t)}}class u{#canvas;#ctx;#reqAnim;#lastTime=0;#deltaTime=0;#effect;#config;running=!1;constructor(t){this.#config=t,this.#canvas=document.createElement("canvas"),this.#canvas.width=this.#config.image.width||this.#config.image.naturalWidth,this.#canvas.height=this.#config.image.height||this.#config.image.naturalHeight,this.#ctx=this.#canvas.getContext("2d"),this.#effect=m.createParticle(t)}update(t){this.#effect.update(t)}draw(){this.#effect.draw(this.#ctx)}start(){this.running||(this.#lastTime=0,this.#config.image.style.display="none",this.#config.image.parentNode.insertBefore(this.#canvas,this.#config.image),this.#reqAnim=requestAnimationFrame(this.loop.bind(this)),this.running=!0)}stop(){this.running&&(this.#config.image.style.display="initial",this.#config.image.parentNode.removeChild(this.#canvas),window.cancelAnimationFrame(this.#reqAnim),this.running=!1)}loop(t){this.#lastTime||(this.#lastTime=t),this.#deltaTime=t-this.#lastTime,this.#lastTime=t,this.update(this.#deltaTime),this.draw(),this.#reqAnim=requestAnimationFrame(this.loop.bind(this))}}var y={};function x(t){y[t.image.id]||(y[t.image.id]={pict2pix:new u(t),running:!0}),y[t.image.id].running=!0,y[t.image.id].pict2pix.start()}function A(t){y[t].running=!1,y[t].pict2pix.stop()}document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?function(){for(var t in y)y[t].running&&y[t].pict2pix.stop()}():function(){for(var t in y)y[t].running&&y[t].pict2pix.start()}()}),!1),pict2pix=i})();